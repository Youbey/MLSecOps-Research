name: GitHub CI ‚Üí Discord Alerts

on:
  push:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          echo "‚úÖ D√©pendances install√©es avec succ√®s"

      - name: Run tests
        run: |
          echo "‚öôÔ∏è Ex√©cution de tests simul√©s..."
          sleep 3
          echo "üß™ Tous les tests passent avec succ√®s ‚úÖ"

      - name: Send success alert to Discord
        if: success()
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          PAYLOAD=$(jq -n --arg content "‚úÖ **Pipeline r√©ussi !**\nüì¶ Job: $GITHUB_JOB\nüîó [Voir le run]($GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID)" '{content: $content}')
          curl -H "Content-Type: application/json" -d "$PAYLOAD" "$DISCORD_WEBHOOK"

      - name: Send failure alert to Discord
        if: failure()
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          PAYLOAD=$(jq -n --arg content "üö® **Pipeline √©chou√© !**\nüì¶ Job: $GITHUB_JOB\nüîó [Voir le run]($GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID)" '{content: $content}')
          curl -H "Content-Type: application/json" -d "$PAYLOAD" "$DISCORD_WEBHOOK"
